<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="eu.greenhouseinnovation.selly.common.model.dao.LocationDao">

    <!-- Queries: -->

    <select id="getById" parameterType="string" resultMap="LocationResult">
        SELECT *
        FROM shoppingmall
        WHERE id = #{locationId}
    </select>

    <select id="getAllLocations" resultMap="LocationResult">
        SELECT *
        FROM shoppingmall
    </select>


    <!-- Social Platform App credentials -->
    <select id="getFacebookAppCredentialsForLocation" resultMap="SocialPlatformAppCredentialsFacebookMap">
        SELECT facebook_id, facebook_secret
        FROM shoppingmall
        WHERE id = #{locationId}
    </select>

    <select id="getTwitterAppCredentialsForLocation" resultMap="SocialPlatformAppCredentialsTwitterMap">
        SELECT twitter_id, twitter_secret
        FROM shoppingmall
        WHERE id = #{locationId}
    </select>

    <select id="getInstagramAppCredentialsForLocation" resultMap="SocialPlatformAppCredentialsInstagramMap">
        SELECT instagram_id, instagram_secret
        FROM shoppingmall
        WHERE id = #{locationId}
    </select>


    <!-- Result maps -->

    <resultMap type="Location" id="LocationResult">
        <constructor>
            <idArg javaType="string" column="id"/>
        </constructor>

        <!-- Generic -->
        <result property="mName" column="name"/>
        <result property="mLocationName" column="locationName"/>
        <result property="mCanonicalUrl" column="canonicalUrl"/>
        <result property="mEmail" column="contactEmail"/>

        <!-- Socials (Links) -->
        <result property="mFacebookPage" column="facebook_page"/>
        <result property="mTwitterHandle" column="twitterUser"/>
        <result property="mInstagramHandle" column="instagramHandle"/>

        <!-- Socials (Application Auth) -->
        <result property="mFacebookId" column="facebook_id"/>
        <result property="mTwitterId" column="twitter_id"/>
        <result property="mInstagramId" column="instagram_id"/>

        <!-- Social fetching (social catch, promoted tags) -->
        <result property="mPreferredHashtag" column="preferredHashtag"/>
        <result property="mCatchHashtags" column="catch_hashtags"/>

        <!-- Analytics -->
        <result property="mAnalyticsCode" column="analyticsCode"/>
        <result property="mAnalyticsDomain" column="analyticsDomain"/>

        <!-- Mobile Application IDs -->
        <result property="mAndroidAppId" column="androidAppId"/>
        <result property="mIosAppId" column="iosAppId"/>

        <!-- Location type and map -->
        <result property="mLocationType" column="location_type"
                typeHandler="eu.greenhouseinnovation.selly.common.mybatis.handlers.LocationTypeHandler"/>
        <result property="mMapUrl" column="map_url"/>


        <!-- Create sparse objects -->
        <association property="mCenterCoordinate" javaType="Wgs84Coordinate">
            <result property="mLatitude" column="latitude"/>
            <result property="mLongitude" column="longitude"/>
        </association>
        <association property="mOpeningHours" javaType="OpeningHours">
            <result property="mMonday" column="monday"/>
            <result property="mTuesday" column="tuesday"/>
            <result property="mWednesday" column="wednesday"/>
            <result property="mThursday" column="thursday"/>
            <result property="mFriday" column="friday"/>
            <result property="mSaturday" column="saturday"/>
            <result property="mSunday" column="sunday"/>
            <result property="mSpecialDay" column="specialday"/>
        </association>
    </resultMap>


    <!-- Social Media application details (for auth, fetching and external/3rd party API use) -->
    <!-- internal use only! these details should not be leaked through the API!! -->
    <resultMap id="SocialPlatformAppCredentialsFacebookMap" type="SocialPlatformAppCredentials">
        <result column="facebook_id" property="mAppId"/>
        <result column="facebook_secret" property="mAppSecret"/>
    </resultMap>

    <resultMap id="SocialPlatformAppCredentialsTwitterMap" type="SocialPlatformAppCredentials">
        <result column="twitter_id" property="mAppId"/>
        <result column="twitter_secret" property="mAppSecret"/>
    </resultMap>

    <resultMap id="SocialPlatformAppCredentialsInstagramMap" type="SocialPlatformAppCredentials">
        <result column="instagram_id" property="mAppId"/>
        <result column="instagram_secret" property="mAppSecret"/>
    </resultMap>

</mapper>
