<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="eu.greenhouseinnovation.selly.common.model.dao.NewsItemDao">

    <!-- Queries: -->
    <select id="getById" parameterType="string" resultType="NewsItem" resultMap="ItemResult">
        SELECT * FROM news WHERE id = #{itemId}
    </select>

    <select id="getByLocationId" parameterType="string" resultType="NewsItem" resultMap="ItemResult">
        SELECT news.* FROM news
        INNER JOIN store ON store.shoppingmallid = news.shoppingmallid
        WHERE store.id = #{locationId}
        <if test="categoryId != null">AND categoryId = #{categoryId}</if>
        AND news.isPublished = 1
        ORDER BY news.datepublished DESC
    </select>

    <select id="getByStoreId" parameterType="string" resultMap="ItemResult">
        SELECT news.* FROM news
        INNER JOIN store ON store.shoppingmallid = news.shoppingmallid
        WHERE store.id = #{storeId}
        <if test="categoryId != null">AND categoryId = #{categoryId}</if>
        AND news.isPublished = 1
        ORDER BY news.datepublished DESC
    </select>


    <!-- Result maps -->

    <resultMap type="NewsItem" id="ItemResult">
        <constructor>
            <idArg javaType="string" column="id"/>
        </constructor>

        <result property="mDateCreated" column="dateCreated"/>
        <result property="mDateModified" column="dateModified"/>
        <result property="mDatePublished" column="datePublished"/>

        <result property="mIsPublished" column="isPublished"/>
        <result property="mIsFeatured" column="isFeatured"/>
        <result property="mAllowComments" column="allowComments"/>


        <result property="mCategoryId" column="categoryId"/>
        <result property="mTitle" column="title"/>
        <result property="mSummary" column="summary"/>
        <result property="mBody" column="content"/>

        <result property="mImagePath" column="picture"/>
        <result property="mThumbPath" column="thumb"/>

        <result property="mSlug" column="url"/>

        <!-- Create sparse objects -->
        <association property="mLocation" javaType="Location">
            <id property="mId" column="shoppingMallId"/>
        </association>
        <association property="mUserCreated" javaType="User">
            <id property="mId" column="userCreated"/>
        </association>
        <association property="mUserModified" javaType="User">
            <id property="mId" column="userCreated"/>
        </association>

    </resultMap>

</mapper>
